<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;padding:12px;background:#fafafa
}
h3{text-align:center;margin:8px 0}
.box{
  background:#fff;border:1px solid #ddd;border-radius:10px;
  padding:10px;margin-bottom:8px
}
select,input,textarea,button{
  width:100%;font-size:16px;padding:10px;margin:6px 0
}
textarea{height:220px}
button{
  background:#0066cc;color:#fff;border:none;
  border-radius:10px;font-weight:600
}
.footer{
  position:sticky;bottom:0;background:#fafafa;padding:10px 0
}
.small{font-size:13px;color:#666;text-align:center}
</style>
</head>

<body>

<h3>üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>

<input type="date" id="dateInput">

<div id="slots"></div>

<button id="btnGenerate">üìù ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>

<textarea id="result" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>

<div class="footer">
  <button id="btnCopy">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å + ‡πÄ‡∏õ‡∏¥‡∏î LINE</button>
  <div class="small">‡∏´‡∏≤‡∏Å LINE ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î LINE ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
</div>

<script>
/* ===== DATE (THAI) ===== */
const thaiDays=["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];
const thaiMonths=["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];

/* ===== DOM ===== */
const slotsEl=document.getElementById("slots");
const dateInput=document.getElementById("dateInput");
const resultEl=document.getElementById("result");

/* ===== LOAD DATABASE.JSON ===== */
let DB=null;

fetch("database.json")
  .then(r=>{
    if(!r.ok) throw "load error";
    return r.json();
  })
  .then(data=>{
    DB=data;
    buildUI();
  })
  .catch(()=>{
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå");
  });

/* ===== BUILD DROPDOWN ===== */
function buildUI(){
  const positions=DB.positions;

  Object.keys(positions).forEach(i=>{
    const pos=positions[i];
    const box=document.createElement("div");
    box.className="box";

    let html=`<b>${i}. ${pos.title}</b>
      <select id="sel_${i}">
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ --</option>`;

    pos.members
      .filter(m=>m.active!==false)
      .forEach((m,idx)=>{
        html+=`<option value="${idx}">
          ${m.rank}${m.name}
        </option>`;
      });

    html+=`</select>`;
    box.innerHTML=html;
    slotsEl.appendChild(box);
  });
}

/* ===== GENERATE REPORT ===== */
document.getElementById("btnGenerate").addEventListener("click",()=>{
  if(!DB) return;

  let body="";
  Object.keys(DB.positions).forEach(i=>{
    const sel=document.getElementById("sel_"+i);
    if(sel && sel.value!==""){
      const p=DB.positions[i].members[sel.value];
      body+=`${i}. ${DB.positions[i].title}
${p.rank}${p.name}
‡πÇ‡∏ó‡∏£.${p.phone}

`;
    }
  });

  if(!body){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏£");
    return;
  }

  const d=dateInput.value?new Date(dateInput.value):new Date();
  const dayThai=thaiDays[d.getDay()];
  const dateThai=`${d.getDate()} ${thaiMonths[d.getMonth()]}${(d.getFullYear()+543).toString().slice(-2)}`;

  const t1="‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏£";
  const t2=`‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô${dayThai} ‡∏ó‡∏µ‡πà ${dateThai}`;
  const max=Math.max(t1.length,t2.length);
  const pad1=" ".repeat(Math.floor((max-t1.length)/2));
  const pad2=" ".repeat(Math.floor((max-t2.length)/2));

  resultEl.value=`${pad1}${t1}
${pad2}${t2}

${body}`;
});

/* ===== COPY + LINE ===== */
document.getElementById("btnCopy").addEventListener("click",async()=>{
  if(!resultEl.value){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô");
    return;
  }
  try{
    await navigator.clipboard.writeText(resultEl.value);
  }catch{
    resultEl.select();
    document.execCommand("copy");
  }
  setTimeout(()=>{ location.href="line://"; },300);
});
</script>

</body>
</html>
