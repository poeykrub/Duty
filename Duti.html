<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>

<style>
body{font-family:sans-serif;margin:0;padding:12px;background:#fafafa}
h3{text-align:center}
select,input,textarea,button{
  width:100%;font-size:16px;padding:10px;margin:6px 0
}
textarea{height:220px}
.box{background:#fff;border:1px solid #ddd;border-radius:10px;padding:10px;margin-bottom:8px}
button{background:#0066cc;color:#fff;border:none;border-radius:10px;font-weight:600}
button.gray{background:#666}
button.red{background:#c00}
.footer{position:sticky;bottom:0;background:#fafafa;padding:10px 0}
</style>
</head>

<body>

<h3>üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>

<div id="reportPage">

<input type="date" id="dateInput">

<div id="slots"></div>

<button id="btnGenerate">üìù ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>

<textarea id="result" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>

<div class="footer">
  <button id="btnCopy">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å + ‡πÄ‡∏õ‡∏¥‡∏î LINE</button>
</div>

<button class="gray" id="btnAdmin">‚öôÔ∏è ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div id="pinPage" style="display:none">
<div class="box">
  <input type="password" id="pinInput" placeholder="‡∏£‡∏´‡∏±‡∏™ 4 ‡∏ï‡∏±‡∏ß">
  <button id="btnPinOk">‡πÄ‡∏Ç‡πâ‡∏≤</button>
  <button class="gray" id="btnPinCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>
</div>

<div id="dbPage" style="display:none">
<h3>üóÇ ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h3>

<select id="posSelect"></select>

<input id="rankInput" placeholder="‡∏¢‡∏®">
<input id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•">
<input id="phoneInput" placeholder="‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
<input type="hidden" id="editId">

<button id="btnSave">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

<div id="list"></div>

<button class="gray" id="btnBack">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<script>
/* ===== CONFIG ===== */
const ADMIN_PIN="2580";
const positions={
  1:"‡∏ô‡∏≤‡∏¢‡∏ó‡∏´‡∏≤‡∏£‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏õ‡∏à‡∏õ‡∏£.‡∏ê‡∏ó.‡∏Å‡∏ó.",
  2:"‡πÄ‡∏™‡∏°‡∏µ‡∏¢‡∏ô‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏ö‡∏Å.‡∏õ‡∏à‡∏õ‡∏£.‡∏ê‡∏ó.‡∏Å‡∏ó.",
  3:"‡πÄ‡∏ß‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏õ‡∏à‡∏õ‡∏£.‡∏ê‡∏ó.‡∏Å‡∏ó.",
  4:"‡πÄ‡∏ß‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏ô‡∏™‡πà‡∏á ‡∏õ‡∏à‡∏õ‡∏£.‡∏ê‡∏ó.‡∏Å‡∏ó.",
  5:"‡πÄ‡∏ß‡∏£‡∏õ‡πâ‡∏≠‡∏°‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏™‡∏°‡∏∏‡∏ó‡∏£",
  6:"‡πÄ‡∏ß‡∏£‡∏£‡∏ñ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏ô‡∏™‡πà‡∏á ‡∏õ‡∏à‡∏õ‡∏£.‡∏ê‡∏ó.‡∏Å‡∏ó.",
  7:"‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏ß‡∏£ ‡∏£‡∏û.‡∏õ‡∏à‡∏õ‡∏£.‡∏ê‡∏ó.‡∏Å‡∏ó.",
  8:"‡πÄ‡∏ß‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏£‡πâ‡∏≠‡∏¢.‡∏£‡∏õ‡∏†.‡∏ó‡∏µ‡πà 5 ‡∏Ø",
  9:"‡∏Å‡∏≠‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏ì‡πå"
};
const thaiDays=["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];
const thaiMonths=["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];

/* ===== CACHE ===== */
const reportPage=document.getElementById("reportPage");
const dateInput=document.getElementById("dateInput");
const slotsEl=document.getElementById("slots");
const resultEl=document.getElementById("result");
const btnGenerate=document.getElementById("btnGenerate");
const btnCopy=document.getElementById("btnCopy");
const btnAdmin=document.getElementById("btnAdmin");

const pinPage=document.getElementById("pinPage");
const pinInput=document.getElementById("pinInput");
const btnPinOk=document.getElementById("btnPinOk");
const btnPinCancel=document.getElementById("btnPinCancel");

const dbPage=document.getElementById("dbPage");
const posSelect=document.getElementById("posSelect");
const rankInput=document.getElementById("rankInput");
const nameInput=document.getElementById("nameInput");
const phoneInput=document.getElementById("phoneInput");
const editId=document.getElementById("editId");
const btnSave=document.getElementById("btnSave");
const listEl=document.getElementById("list");
const btnBack=document.getElementById("btnBack");

/* ===== DATABASE ===== */
let dutyDB=JSON.parse(localStorage.getItem("dutyDB"))||{1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[]};
function saveDB(){localStorage.setItem("dutyDB",JSON.stringify(dutyDB));}

/* ===== BUILD REPORT UI ===== */
Object.keys(positions).forEach(i=>{
  const d=document.createElement("div");
  d.className="box";
  d.innerHTML=`<b>${i}. ${positions[i]}</b>
  <select id="sel_${i}"><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ --</option></select>`;
  slotsEl.appendChild(d);
});
function refreshSelects(){
  Object.keys(positions).forEach(i=>{
    const sel=document.getElementById("sel_"+i);
    sel.innerHTML='<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ --</option>';
    dutyDB[i].forEach((p,idx)=>{
      sel.innerHTML+=`<option value="${idx}">${p.rank}${p.name}</option>`;
    });
  });
}
refreshSelects();

/* ===== GENERATE REPORT ===== */
btnGenerate.addEventListener("click",()=>{
  let body="";
  Object.keys(positions).forEach(i=>{
    const sel=document.getElementById("sel_"+i);
    if(sel.value!==""){
      const p=dutyDB[i][sel.value];
      body+=`${i}. ${positions[i]}
${p.rank}${p.name}
‡πÇ‡∏ó‡∏£.${p.phone}

`;
    }
  });
  if(!body){alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏£");return;}

  const d=dateInput.value?new Date(dateInput.value):new Date();
  const dayThai=thaiDays[d.getDay()];
  const dateThai=`${d.getDate()} ${thaiMonths[d.getMonth()]}${(d.getFullYear()+543).toString().slice(-2)}`;

  const t1="‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏£";
  const t2=`‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô${dayThai} ‡∏ó‡∏µ‡πà ${dateThai}`;
  const max=Math.max(t1.length,t2.length);
  const p1=" ".repeat(Math.floor((max-t1.length)/2));
  const p2=" ".repeat(Math.floor((max-t2.length)/2));

  resultEl.value=`${p1}${t1}
${p2}${t2}

${body}`;
});

/* ===== COPY + LINE ===== */
btnCopy.addEventListener("click",async()=>{
  if(!resultEl.value){alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");return;}
  try{await navigator.clipboard.writeText(resultEl.value);}
  catch{resultEl.select();document.execCommand("copy");}
  setTimeout(()=>{location.href="line://";},300);
});

/* ===== ADMIN ===== */
btnAdmin.onclick=()=>pinPage.style.display="block";
btnPinCancel.onclick=()=>pinPage.style.display="none";
btnPinOk.onclick=()=>{
  if(pinInput.value===ADMIN_PIN){
    pinPage.style.display="none";
    reportPage.style.display="none";
    dbPage.style.display="block";
    loadDBList();
  }else alert("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
};

/* ===== DATABASE UI ===== */
Object.keys(positions).forEach(i=>{
  posSelect.innerHTML+=`<option value="${i}">${positions[i]}</option>`;
});
function loadDBList(){
  listEl.innerHTML="";
  const p=posSelect.value;
  dutyDB[p].forEach(v=>{
    const d=document.createElement("div");
    d.className="box";
    d.textContent=`${v.rank}${v.name} (${v.phone})`;
    const e=document.createElement("button");
    e.textContent="‚úèÔ∏è";
    e.onclick=()=>{
      editId.value=v.id;
      rankInput.value=v.rank;
      nameInput.value=v.name;
      phoneInput.value=v.phone;
    };
    const x=document.createElement("button");
    x.textContent="üóë";x.className="red";
    x.onclick=()=>{
      dutyDB[p]=dutyDB[p].filter(i=>i.id!==v.id);
      saveDB();loadDBList();refreshSelects();
    };
    d.append(e,x);listEl.appendChild(d);
  });
}
btnSave.onclick=()=>{
  const p=posSelect.value;
  if(editId.value){
    Object.assign(dutyDB[p].find(i=>i.id==editId.value),
      {rank:rankInput.value,name:nameInput.value,phone:phoneInput.value});
    editId.value="";
  }else{
    dutyDB[p].push({id:Date.now(),rank:rankInput.value,name:nameInput.value,phone:phoneInput.value});
  }
  rankInput.value=nameInput.value=phoneInput.value="";
  saveDB();loadDBList();refreshSelects();
};
posSelect.onchange=loadDBList;
btnBack.onclick=()=>{
  dbPage.style.display="none";
  reportPage.style.display="block";
};
</script>

</body>
</html>